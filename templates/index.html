{% extends 'base.html' %}
{% block title %}Busca de Asteroides{% endblock %}

{% block content %}

<div id="search-section">
    <div class="alert alert-info alert-dismissible fade show d-none" id="mcti-catalog-tip-alert" role="alert">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle fa-lg me-3"></i>
            <div>
                <strong>Dica:</strong> É participante das campanhas MCTI mas não se lembra das suas deteções? 
                <a href="{{ url_for('deteccoes_mcti') }}" class="alert-link">Visite o Catálogo de Deteções MCTI</a>.
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div class="main-card mx-auto">
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold">Busca de Asteroides</h1>
            <p class="text-secondary">Insira os identificadores para iniciar a busca.</p>
        </div>
        <form id="search-form" onsubmit="return false;">
            <div class="mb-3">
                <textarea class="form-control" name="identificadores" id="identificadores-input" rows="8" 
                          placeholder="A busca funciona com códigos de asteroides preliminares. Cole um ou mais códigos na caixa de texto, um por linha.&#10;&#10;Exemplos de códigos válidos:&#10;IUc7254&#10;P11jMkA&#10;P21ESwb" 
                          required></textarea>
            </div>
            <div class="d-grid">
                <button id="search-button" type="submit" class="btn btn-primary btn-lg"><i class="fas fa-search me-2"></i> Buscar</button>
            </div>
        </form>
    </div>
</div>

<div id="results-section" class="d-none">

    <div class="alert alert-success alert-dismissible fade show" id="save-results-alert" role="alert" style="display: none;">
        <div class="d-flex align-items-center">
            <i class="fas fa-check-circle fa-lg me-3"></i>
            <div>
                <strong>Dica:</strong> Resultados encontrados! Agora você pode usar os botões "Salvar" para adicioná-los a uma das suas tabelas.
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

     <div class="alert alert-primary alert-dismissible fade show" id="customize-view-alert" role="alert" style="display: none;">
        <div class="d-flex align-items-center">
            <i class="fas fa-palette fa-lg me-3"></i>
            <div>
                <strong>Dica:</strong> Para uma visualização perfeita, <a href="/configuracoes" class="alert-link">vá para Configurações</a> e personalize as colunas!
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="results-card">
        <div class="results-header d-flex justify-content-between align-items-center flex-wrap gap-2">
            <h4 class="m-0">Resultados da Busca</h4>
            <div class="d-flex align-items-center gap-3">
                <span id="results-count" class="badge bg-light text-dark fs-6"></span>
                <button id="new-search-btn" class="btn btn-primary"><i class="fas fa-search me-2"></i>Nova Busca</button>
            </div>
        </div>
        <div class="p-3">
            <div class="d-flex flex-wrap gap-3 mb-3 align-items-center">
                <div class="d-flex align-items-center gap-2">
                    <label for="table-select-dropdown" class="form-label mb-0">Salvar em:</label>
                    <select id="table-select-dropdown" class="form-select" style="width: auto;"></select>
                </div>
                <div class="d-flex gap-2 ms-auto align-items-center">
                    <div id="initial-save-buttons" class="d-flex gap-2">
                        <span data-bs-toggle="popover" data-bs-trigger="click" data-bs-placement="top" title="Salvar Tudo" data-bs-content="Salva todos os resultados encontrados na tabela selecionada.">
                            <button id="save-all-btn" type="button" class="btn btn-success"><i class="fas fa-save me-2"></i> Salvar Tudo</button>
                        </span>
                        <span data-bs-toggle="popover" data-bs-trigger="click" data-bs-placement="top" title="Salvar Linhas Específicas" data-bs-content="Ativa o modo de seleção para você escolher quais linhas salvar.">
                            <button id="enable-select-mode-btn" type="button" class="btn btn-outline-info"><i class="fas fa-check-square me-2"></i> Salvar Linhas</button>
                        </span>
                    </div>
                    <div id="selection-controls" class="d-none gap-2">
                        <button id="save-selected-btn" type="button" class="btn btn-info" disabled><i class="fas fa-check me-2"></i> Salvar Selecionadas</button>
                        <button id="cancel-select-mode-btn" type="button" class="btn btn-secondary">Cancelar</button>
                    </div>
                </div>
            </div>
            <p id="selection-instruction" class="selection-instruction text-center mb-3 d-none"><i class="fas fa-mouse-pointer"></i> Clique nas linhas ou marque as caixas para selecionar.</p>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead id="results-thead"></thead>
                    <tbody id="results-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/search_manager.js') }}"></script>
{% endblock %}